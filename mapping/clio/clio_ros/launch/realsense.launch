<launch>

    <!-- rosbag controls -->
    <arg name="sim_time_required" default="false"/>
    <param name="use_sim_time" value="$(arg sim_time_required)"/>
    <!-- general configuration -->
    <arg name="dataset_name" default="realsense" doc="Dataset name (used for parsing config)"/>
    <arg name="ablation_name" default="realsense_fine" doc="Ablation name (used for parsing config)"/>
    <arg name="segmenter_config" default="$(find clio_ros)/config/segmentation/detection.yaml" doc="openset detection config to use"/>
    <!-- tf frames -->
    <arg name="map_frame" default="world"/>
    <arg name="odom_frame" default="world"/>
    <arg name="robot_frame" default="dominic/forward_link"/>
    <arg name="sensor_frame" default="dominic/forward_link"/>

    <arg name="object_tasks" default="[]" doc="List of object tasks"/>
    <arg name="object_tasks_file" default="/home/apple/Work/exp_pipeline_ws/datasets/objects_habitat_apartment.yaml" doc="File to read object tasks from (preferred over object_tasks)"/>
    <arg name="place_tasks" default="[]" doc="List of place tasks"/>
    <arg name="place_tasks_file" default="/home/apple/Work/exp_pipeline_ws/datasets/region_tasks_habitat_apartment.yaml" doc="File to read place tasks from (preferred over place_tasks)"/>
    <arg name="scene_number" default="871" doc="Scene number to load"/>

    <!-- use in object detectors -->
    <rosparam command="load" file="$(arg object_tasks_file)" param="detector_tasks" />
    <!-- <param name="detector_tasks_file" value="$(arg object_tasks_file)"/> -->

    <arg name="run_segmentation" default="true"/>
    <group if="$(arg run_segmentation)">
        <remap from="semantic_inference/color/image_raw" to="/dominic/forward/color/image_raw"/>
        <remap from="semantic_inference/semantic/image_raw" to="/dominic/forward/semantic/image_raw"/>
        <remap from="semantic_inference/semantic/feature" to="/dominic/forward/semantic/clip_vector"/>
         <!-- <node name="segmenter_ros" pkg="segmenter_ros" type="segmenter_yoso.py" output="screen">
            <rosparam command="load" file="$(find segmenter_ros)/config/cfg_yoso.yaml" />
            <param name="visualize" value="true" />
        </node> -->
        <include file="$(find semantic_inference_ros)/launch/openset_detection.launch">
            <arg name="config_path" value="$(arg segmenter_config)"/>
        </include>
    </group>

    <group unless="$(arg run_segmentation)">
        <node pkg="semantic_inference_ros" type="language_embedding_node" name="semantic_inference">
            <rosparam file="$(arg segmenter_config)"/> <!-- sets model name -->
        </node>
    </group>

    <arg name="run_clio" default="true"/>
    <group if="$(arg run_clio)">
        <!-- TODO(nathan) change topic -->
        <remap from="/clio_node/input/camera/rgb/image_raw" to="/dominic/forward/color/image_raw"/>
        <remap from="/clio_node/input/camera/depth_registered/image_rect" to="/dominic/forward/depth/image_rect_raw"/>
        <remap from="/clio_node/input/camera/semantic/image_raw" to="/dominic/forward/semantic/image_raw"/>
        <remap from="/clio_node/input/camera/feature" to="/dominic/forward/semantic/clip_vector"/>
        <include file="$(find clio_ros)/launch/clio.launch" pass_all_args="true">
            <arg name="sensor_min_range" default="0.3" doc="minimum sensor range in meters"/>
            <arg name="sensor_max_range" default="4.0" doc="maximum sensor range in meters"/>
        </include>
    </group>

    <include file="$(find vs_graphs)/launch/vs_graphs.launch"/>

</launch>
